import{ZIndexUtils as e,DomHandler as t,ConnectedOverlayScrollHandler as i}from"primevue/utils";import l from"primevue/overlayeventbus";import s from"primevue/tree";import n from"primevue/ripple";import{resolveComponent as r,openBlock as o,createBlock as a,createVNode as d,renderSlot as c,Fragment as p,createTextVNode as h,toDisplayString as u,renderList as y,createCommentVNode as f,Teleport as m,Transition as b,withCtx as v}from"vue";var g={name:"TreeSelect",emits:["update:modelValue","before-show","before-hide","change","show","hide","node-select","node-unselect","node-expand","node-collapse"],props:{modelValue:null,options:Array,scrollHeight:{type:String,default:"400px"},placeholder:String,disabled:Boolean,tabindex:String,inputId:String,ariaLabelledBy:null,selectionMode:{type:String,default:"single"},panelClass:{type:String,default:null},appendTo:{type:String,default:"body"},emptyMessage:{type:String,default:null},display:{type:String,default:"comma"},metaKeySelection:{type:Boolean,default:!0}},watch:{modelValue:{handler:function(){this.selfChange||this.updateTreeState(),this.selfChange=!1},immediate:!0},options(){this.updateTreeState()}},data:()=>({focused:!1,overlayVisible:!1,expandedKeys:{}}),outsideClickListener:null,resizeListener:null,scrollHandler:null,overlay:null,selfChange:!1,beforeUnmount(){this.unbindOutsideClickListener(),this.unbindResizeListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null),this.overlay&&(e.clear(this.overlay),this.overlay=null)},mounted(){this.updateTreeState()},methods:{show(){this.$emit("before-show"),this.overlayVisible=!0},hide(){this.$emit("before-hide"),this.overlayVisible=!1},onFocus(){this.focused=!0},onBlur(){this.focused=!1},onClick(e){this.disabled||this.overlay&&this.overlay.contains(e.target)||t.hasClass(e.target,"p-treeselect-close")||(this.overlayVisible?this.hide():this.show(),this.$refs.focusInput.focus())},onSelectionChange(e){this.selfChange=!0,this.$emit("update:modelValue",e),this.$emit("change",e)},onNodeSelect(e){this.$emit("node-select",e),"single"===this.selectionMode&&this.hide()},onNodeUnselect(e){this.$emit("node-unselect",e)},onNodeToggle(e){this.expandedKeys=e},onKeyDown(e){switch(e.which){case 40:!this.overlayVisible&&e.altKey&&(this.show(),e.preventDefault());break;case 32:this.overlayVisible||(this.show(),e.preventDefault());break;case 13:case 27:this.overlayVisible&&(this.hide(),e.preventDefault());break;case 9:this.hide()}},onOverlayEnter(t){e.set("overlay",t,this.$primevue.config.zIndex.overlay),this.alignOverlay(),this.bindOutsideClickListener(),this.bindScrollListener(),this.bindResizeListener(),this.scrollValueInView(),this.$emit("show")},onOverlayLeave(){this.unbindOutsideClickListener(),this.unbindScrollListener(),this.unbindResizeListener(),this.$emit("hide"),this.overlay=null},onOverlayAfterLeave(t){e.clear(t)},alignOverlay(){this.appendDisabled?t.relativePosition(this.overlay,this.$el):(this.overlay.style.minWidth=t.getOuterWidth(this.$el)+"px",t.absolutePosition(this.overlay,this.$el))},bindOutsideClickListener(){this.outsideClickListener||(this.outsideClickListener=e=>{this.overlayVisible&&this.isOutsideClicked(e)&&this.hide()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},bindScrollListener(){this.scrollHandler||(this.scrollHandler=new i(this.$refs.container,(()=>{this.overlayVisible&&this.hide()}))),this.scrollHandler.bindScrollListener()},unbindScrollListener(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()},bindResizeListener(){this.resizeListener||(this.resizeListener=()=>{this.overlayVisible&&this.hide()},window.addEventListener("resize",this.resizeListener))},unbindResizeListener(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},isOutsideClicked(e){return!(this.$el.isSameNode(e.target)||this.$el.contains(e.target)||this.overlay&&this.overlay.contains(e.target))},overlayRef(e){this.overlay=e},onOverlayClick(e){l.emit("overlay-click",{originalEvent:e,target:this.$el})},findSelectedNodes(e,t,i){if(e){if(this.isSelected(e,t)&&(i.push(e),delete t[e.key]),Object.keys(t).length&&e.children)for(let l of e.children)this.findSelectedNodes(l,t,i)}else for(let e of this.options)this.findSelectedNodes(e,t,i)},isSelected(e,t){return"checkbox"===this.selectionMode?t[e.key]&&t[e.key].checked:t[e.key]},updateTreeState(){let e={...this.modelValue};this.expandedKeys={},e&&this.options&&this.updateTreeBranchState(null,null,e)},updateTreeBranchState(e,t,i){if(e){if(this.isSelected(e,i)&&(this.expandPath(t),delete i[e.key]),Object.keys(i).length&&e.children)for(let l of e.children)t.push(e.key),this.updateTreeBranchState(l,t,i)}else for(let e of this.options)this.updateTreeBranchState(e,[],i)},expandPath(e){if(e.length>0)for(let t of e)this.expandedKeys[t]=!0},scrollValueInView(){if(this.overlay){let e=t.findSingle(this.overlay,"li.p-highlight");e&&e.scrollIntoView({block:"nearest",inline:"start"})}}},computed:{containerClass(){return["p-treeselect p-component p-inputwrapper",{"p-treeselect-chip":"chip"===this.display,"p-disabled":this.disabled,"p-focus":this.focused,"p-inputwrapper-filled":!this.emptyValue,"p-inputwrapper-focus":this.focused||this.overlayVisible}]},labelClass(){return["p-treeselect-label",{"p-placeholder":this.label===this.placeholder,"p-treeselect-label-empty":!this.placeholder&&this.emptyValue}]},panelStyleClass(){return["p-treeselect-panel p-component",this.panelClass,{"p-input-filled":"filled"===this.$primevue.config.inputStyle,"p-ripple-disabled":!1===this.$primevue.config.ripple}]},selectedNodes(){let e=[];if(this.modelValue&&this.options){let t={...this.modelValue};this.findSelectedNodes(null,t,e)}return e},label(){let e=this.selectedNodes;return e.length?e.map((e=>e.label)).join(", "):this.placeholder},emptyMessageText(){return this.emptyMessage||this.$primevue.config.locale.emptyMessage},emptyValue(){return!this.modelValue||0===Object.keys(this.modelValue).length},emptyOptions(){return!this.options||0===this.options.length},appendDisabled(){return"self"===this.appendTo},appendTarget(){return this.appendDisabled?null:this.appendTo}},components:{TSTree:s},directives:{ripple:n}};const x={class:"p-hidden-accessible"},k={class:"p-treeselect-label-container"},S={class:"p-treeselect-token-label"},w={class:"p-treeselect-trigger"},L=d("span",{class:"p-treeselect-trigger-icon pi pi-chevron-down"},null,-1),C={key:0,class:"p-treeselect-empty-message"};!function(e,t){void 0===t&&(t={});var i=t.insertAt;if(e&&"undefined"!=typeof document){var l=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css","top"===i&&l.firstChild?l.insertBefore(s,l.firstChild):l.appendChild(s),s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}}("\n.p-treeselect {\r\n    display: -webkit-inline-box;\r\n    display: -ms-inline-flexbox;\r\n    display: inline-flex;\r\n    cursor: pointer;\r\n    position: relative;\r\n    -webkit-user-select: none;\r\n       -moz-user-select: none;\r\n        -ms-user-select: none;\r\n            user-select: none;\n}\n.p-treeselect-trigger {\r\n    display: -webkit-box;\r\n    display: -ms-flexbox;\r\n    display: flex;\r\n    -webkit-box-align: center;\r\n        -ms-flex-align: center;\r\n            align-items: center;\r\n    -webkit-box-pack: center;\r\n        -ms-flex-pack: center;\r\n            justify-content: center;\r\n    -ms-flex-negative: 0;\r\n        flex-shrink: 0;\n}\n.p-treeselect-label-container {\r\n    overflow: hidden;\r\n    -webkit-box-flex: 1;\r\n        -ms-flex: 1 1 auto;\r\n            flex: 1 1 auto;\r\n    cursor: pointer;\n}\n.p-treeselect-label  {\r\n    display: block;\r\n    white-space: nowrap;\r\n    cursor: pointer;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\n}\n.p-treeselect-label-empty {\r\n    overflow: hidden;\r\n    visibility: hidden;\n}\n.p-treeselect-token {\r\n    cursor: default;\r\n    display: -webkit-inline-box;\r\n    display: -ms-inline-flexbox;\r\n    display: inline-flex;\r\n    -webkit-box-align: center;\r\n        -ms-flex-align: center;\r\n            align-items: center;\r\n    -webkit-box-flex: 0;\r\n        -ms-flex: 0 0 auto;\r\n            flex: 0 0 auto;\n}\n.p-treeselect .p-treeselect-panel {\r\n    min-width: 100%;\n}\n.p-treeselect-panel {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\n}\n.p-treeselect-items-wrapper {\r\n    overflow: auto;\n}\n.p-fluid .p-treeselect {\r\n    display: -webkit-box;\r\n    display: -ms-flexbox;\r\n    display: flex;\n}\r\n"),g.render=function(e,t,i,l,s,n){const g=r("TSTree");return o(),a("div",{ref:"container",class:n.containerClass,onClick:t[7]||(t[7]=(...e)=>n.onClick&&n.onClick(...e))},[d("div",x,[d("input",{ref:"focusInput",type:"text",role:"listbox",id:i.inputId,readonly:"",disabled:i.disabled,onFocus:t[1]||(t[1]=(...e)=>n.onFocus&&n.onFocus(...e)),onBlur:t[2]||(t[2]=(...e)=>n.onBlur&&n.onBlur(...e)),onKeydown:t[3]||(t[3]=(...e)=>n.onKeyDown&&n.onKeyDown(...e)),tabindex:i.tabindex,"aria-haspopup":"true","aria-expanded":s.overlayVisible,"aria-labelledby":i.ariaLabelledBy},null,40,["id","disabled","tabindex","aria-expanded","aria-labelledby"])]),d("div",k,[d("div",{class:n.labelClass},[c(e.$slots,"value",{value:n.selectedNodes,placeholder:i.placeholder},(()=>["comma"===i.display?(o(),a(p,{key:0},[h(u(n.label||"empty"),1)],2112)):"chip"===i.display?(o(),a(p,{key:1},[(o(!0),a(p,null,y(n.selectedNodes,(e=>(o(),a("div",{class:"p-treeselect-token",key:e.key},[d("span",S,u(e.label),1)])))),128)),n.emptyValue?(o(),a(p,{key:0},[h(u(i.placeholder||"empty"),1)],2112)):f("v-if",!0)],64)):f("v-if",!0)]))],2)]),d("div",w,[c(e.$slots,"indicator",{},(()=>[L]))]),(o(),a(m,{to:n.appendTarget,disabled:n.appendDisabled},[d(b,{name:"p-connected-overlay",onEnter:n.onOverlayEnter,onLeave:n.onOverlayLeave,onAfterLeave:n.onOverlayAfterLeave},{default:v((()=>[s.overlayVisible?(o(),a("div",{key:0,ref:n.overlayRef,onClick:t[6]||(t[6]=(...e)=>n.onOverlayClick&&n.onOverlayClick(...e)),class:n.panelStyleClass},[c(e.$slots,"header",{value:i.modelValue,options:i.options}),d("div",{class:"p-treeselect-items-wrapper",style:{"max-height":i.scrollHeight}},[d(g,{value:i.options,selectionMode:i.selectionMode,"onUpdate:selectionKeys":n.onSelectionChange,selectionKeys:i.modelValue,expandedKeys:s.expandedKeys,"onUpdate:expandedKeys":n.onNodeToggle,metaKeySelection:i.metaKeySelection,onNodeExpand:t[4]||(t[4]=t=>e.$emit("node-expand",t)),onNodeCollapse:t[5]||(t[5]=t=>e.$emit("node-collapse",t)),onNodeSelect:n.onNodeSelect,onNodeUnselect:n.onNodeUnselect},null,8,["value","selectionMode","onUpdate:selectionKeys","selectionKeys","expandedKeys","onUpdate:expandedKeys","metaKeySelection","onNodeSelect","onNodeUnselect"]),n.emptyOptions?(o(),a("div",C,[c(e.$slots,"empty",{},(()=>[h(u(n.emptyMessageText),1)]))])):f("v-if",!0)],4),c(e.$slots,"footer",{value:i.modelValue,options:i.options})],2)):f("v-if",!0)])),_:3},8,["onEnter","onLeave","onAfterLeave"])],8,["to","disabled"]))],2)},g.__file="src/components/treeselect/TreeSelect.vue";export{g as default};
